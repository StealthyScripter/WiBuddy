<!-- market-insight.component.html -->
<div class="market-container" *ngIf="!loading && marketData; else loadingState">
  <!-- Header -->
  <div class="market-header-section">
    <button (click)="goBack()" class="back-button">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
      Back
    </button>
    <div>
      <h1 class="market-page-title">Market Insights</h1>
      <p class="market-page-subtitle">Job market trends, salary data, and growth forecasts</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="market-main">
    <div class="market-grid">
      <!-- Left Column - Job Market -->
      <div class="market-left">
        <!-- Filter Bar -->
        <div class="filter-section">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="filter-icon">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
          </svg>
          <button *ngFor="let cat of categories"
                  (click)="selectedCategory = cat"
                  [class.active]="selectedCategory === cat"
                  class="filter-button">
            {{ cat | titlecase }}
          </button>
        </div>

        <!-- Job Listings -->
        <div class="card">
          <h2 class="card-title">Available Opportunities</h2>
          <div class="jobs-list">
            <div *ngFor="let job of getFilteredJobs()" class="job-card">
              <div class="job-header">
                <div class="job-info">
                  <h3 class="job-title">{{ job.title }}</h3>
                  <p class="job-company">{{ job.company }} • {{ job.location }}</p>
                </div>
                <span class="job-match">{{ job.matchPercentage }}% match</span>
              </div>
              <p class="job-description">{{ job.description }}</p>
              <div class="job-skills">
                <span *ngFor="let skill of job.requiredSkills" class="skill-tag">
                  {{ skill }}
                </span>
              </div>
              <div class="job-footer">
                <div class="job-meta">
                  <span *ngIf="job.salary">{{ job.salary }}</span>
                  <span *ngIf="job.salary">•</span>
                  <span>Posted {{ job.postedDate }}</span>
                </div>
                <a [href]="job.link" target="_blank" class="job-link">View Job →</a>
              </div>
            </div>

            <div *ngIf="getFilteredJobs().length === 0" class="empty-message">
              <p>No jobs found for this category</p>
            </div>
          </div>
        </div>

        <!-- Market Trends -->
        <div class="card">
          <h2 class="card-title">Market Trends</h2>
          <div class="trends-list">
            <div *ngFor="let trend of marketData.trends.slice(0, 5)" class="trend-item">
              <div class="trend-header">
                <div class="trend-info">
                  <h3 class="trend-name">{{ trend.name }}</h3>
                  <p class="trend-category">{{ trend.category }}</p>
                </div>
                <span *ngIf="trend.growthRate && trend.growthRate > 0" class="growth-badge">
                  +{{ trend.growthRate }}%
                </span>
              </div>
              <div class="trend-stats">
                <span>{{ trend.jobListingCount | number }} positions</span>
                <span class="dot">•</span>
                <span class="market-demand">{{ trend.marketLevel }}% demand</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Insights -->
      <div class="market-right">
        <!-- Top Growing Skills -->
        <div class="card">
          <h3 class="card-title">Top Growing Skills</h3>
          <div class="skills-list">
            <div *ngFor="let skill of marketData.topGrowingSkills" class="skill-card">
              <div class="skill-header">
                <span class="skill-name">{{ skill.name }}</span>
                <span class="skill-growth">+{{ skill.growth }}%</span>
              </div>
              <div class="skill-bar">
                <div class="skill-progress" [style.width.%]="skill.growth"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Salary Ranges -->
        <div class="card">
          <h3 class="card-title">Salary Ranges</h3>
          <div class="salary-list">
            <div *ngFor="let role of marketData.salaryInsight | keyvalue" class="salary-item">
              <p class="salary-role">{{ role.key }}</p>
              <p class="salary-amount">{{ role.value }}</p>
            </div>
          </div>
        </div>

        <!-- Market Status -->
        <div class="card market-status-card">
          <h3 class="card-title">Overall Market Status</h3>
          <div class="status-content">
            <div class="status-item">
              <p class="status-label">Demand Trend</p>
              <div class="status-value">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="trend-icon">
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                  <polyline points="17 6 23 6 23 12"></polyline>
                </svg>
                <span>{{ marketData.demandTrend | titlecase }}</span>
              </div>
            </div>
            <div class="status-item">
              <p class="status-label">Market Insight</p>
              <p class="status-description">Strong demand across all tech sectors with AI/ML showing highest growth potential</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<ng-template #loadingState>
  <div class="loading-container">
    <div class="spinner"></div>
    <p class="loading-text">Loading market insights...</p>
  </div>
</ng-template>
