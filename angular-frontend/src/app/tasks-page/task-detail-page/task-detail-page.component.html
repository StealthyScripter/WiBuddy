@if (selectedTask) {
  <div class="page-container">
    <header class="page-header">
      <div class="header-actions">
        <button class="icon-button" (click)="onBack()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
        <button class="icon-button" (click)="onEdit()">
          <i class="fas fa-edit"></i> Edit
        </button>
        <button class="icon-button danger" (click)="onDelete()">
          <i class="fas fa-trash"></i> Delete
        </button>
      </div>
    </header>
    <div class="header-left">
      <h1 class="page-title">{{ selectedTask.name }}</h1>
      <span class="status-badge" [ngClass]="'status-badge ' + (selectedTask.completionStatus | lowercase)">
        {{ selectedTask.completionStatus | titlecase }}
      </span>
    </div>
    <div class="content-grid">
      <div class="main-content">
        <section class="content-section">
          <h2 class="section-title">Description</h2>
          <p class="description-text">{{ selectedTask.description || 'No description provided' }}</p>
        </section>
        <section class="content-section">
          <h2 class="section-title">Prerequisites</h2>
          @if (selectedTask.prerequisites) {
            <ul class="prerequisites-list">
              @for (prereq of selectedTask.prerequisites; track prereq) {
                <li class="prerequisite-item">
                  <span class="check-icon">âœ“</span>
                  {{ prereq }}
                </li>
              }
            </ul>
          } @else {
            <p class="description-text">No prerequisites for this task</p>
          }
        </section>
        <section class="content-section">
          <h2 class="section-title">Comments</h2>
          <div class="comments-container">
            <div class="comment-input">
              <div class="avatar">
                <img src="icons8-profile-picture.png" alt="User avatar">
              </div>
            </div>
            <ng-template #noComments>
              <p class="description-text">No comments yet</p>
            </ng-template>
          </div>
        </section>
      </div>
      <aside class="sidebar">
        <section class="sidebar-section">
          <h2 class="section-title">Task Information</h2>
          <div class="info-grid">
            <!-- Due Date -->
            <div class="info-item">
              <label>Due Date</label>
              <div class="info-value">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                {{ selectedTask.dueDate ? (selectedTask.dueDate | date:'mediumDate') : 'Not set' }}
              </div>
            </div>
            <!-- Priority -->
            <div class="info-item">
              <label>Priority</label>
              <div class="info-value">
                <span class="priority-badge" [ngClass]="selectedTask.priority | lowercase">
                  {{ selectedTask.priority | titlecase }}
                </span>
              </div>
            </div>
            <!-- Category -->
            <div class="info-item">
              <label>Category</label>
              <div class="info-value category-value">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                  <line x1="7" y1="7" x2="7.01" y2="7"></line>
                </svg>
                {{ selectedTask.category ? (selectedTask.category | titlecase) : 'Uncategorized' }}
              </div>
            </div>
            <!-- Estimated Duration -->
            <div class="info-item">
              <label>Estimated Duration</label>
              <div class="info-value">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                {{ selectedTask.estimatedDuration ? selectedTask.estimatedDuration : 'Not specified' }}
              </div>
            </div>
            <!-- Estimated Duration -->
            <div class="info-item">
              <label>Running Duration</label>
              <div class="info-value">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                {{ selectedTask.dateCreated ? selectedTask : 'Not specified' }}
              </div>
            </div>
            <!-- Milestone Status -->
            <div class="info-item">
              <label>Milestone</label>
              <div class="info-value">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path>
                </svg>
                <span class="milestone-status">{{ selectedTask.isMilestone ? 'Yes' : 'No' }}</span>
              </div>
            </div>
            <!-- Associated Project -->
            @if (selectedTask.projectId) {
              <div class="info-item">
                <label>Project</label>
                <div class="info-value">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                  </svg>
                  {{ getProjectName(selectedTask.projectId) }}
                </div>
              </div>
            }
            <!-- Tags -->
            @if (selectedTask.tags?.length) {
              <div class="info-item">
                <label>Tags</label>
                <div class="tags-container">
                  @for (tag of selectedTask.tags; track tag) {
                    <span class="tag">{{ tag }}</span>
                  }
                </div>
              </div>
            }
            <!-- Creation Date -->
            @if (selectedTask.dateCreated) {
              <div class="info-item">
                <label>Created</label>
                <div class="info-value">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  {{ selectedTask.dateCreated | date:'mediumDate' }}
                </div>
              </div>
            }
          </div>
        </section>
        @if (selectedTask.attachments?.length) {
          <section class="sidebar-section">
            <h2 class="section-title">Attachments</h2>
            <div class="attachments-list">
              @for (attachment of selectedTask.attachments; track attachment) {
                <a href="#" class="attachment-item">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                  </svg>
                  {{ attachment.name }}
                </a>
              }
            </div>
          </section>
        }
      </aside>
    </div>
  </div>
} @else {
  <div class="loading">Loading task details...</div>
}
